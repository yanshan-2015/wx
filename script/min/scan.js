function checkPhone(){var e=$(".phone").val();e.length>11&&$(".phone").val(e.slice(0,11))}function userinfo(e,t){$.ajax({type:"post",url:path+"/getweiuserinfo",dataType:"jsonp",jsonp:"jsoncallback",data:{openId:e},success:function(e){void 0==e.nickname&&($(".focus").show(),$(".form").hide())}})}function getNum(e){$.ajax({type:"post",url:path+"/sendmsg",dataType:"jsonp",jsonp:"jsoncallback",data:{mobile:e},success:function(e){var t=e.msg;void 0!=t?"发送成功"==t||("请求参数格式错误"==t?alert("您输入的手机有误。"):alert(t)):alert("您的网络有问题。")}})}function checkNum(e,t,a,n,o,s,i,c,r){$.ajax({type:"post",url:path+"/verifymsg",dataType:"jsonp",jsonp:"jsoncallback",data:{mobile:$(".phone").val(),verifyCode:e,openId:s},success:function(e){var u=e.msg;void 0!=u?"验证码已经过期!"==u?alert("验证码已过期!"):"验证码错误!"==u?alert("验证码错误！"):"OK"==u&&$.ajax({async:!0,type:"get",url:path+"/getproinfo",dataType:"jsonp",jsonp:"jsoncallback",data:{fenBarCode:t},success:function(e){void 0!=e[0]&&void 0==e[0].fstkOutLogNo&&(c=0),c=0==e.length?0:void 0==e[0].fstkOutLogNo?0:1,sendUserInfo(t,a,n,o,s,i,c,r)},error:function(e){alert("防伪验证失败！")}}):alert("您的网络有问题！")},error:function(e){alert("您的网络有问题！")}})}function sendUserInfo(e,t,a,n,o,s,i,c){$.ajax({type:"post",url:path+"/savescaninfo",dataType:"jsonp",jsonp:"jsoncallback",data:{barCode:e,scanDate:t,jingdu:a,weidu:n,weiChartNo:o,telphone:$(".phone").val(),name:s,status:i},success:function(t){"OK"==t.msg&&(location.href="result.html?barCode="+e+"&id="+t.obj+"&phone="+c+"&jingdu="+a+"&weidu="+n+"&name="+encodeURI(encodeURI(s))+"&status="+i)},error:function(e){}})}function time(e){0==wait?($(".getnum").removeClass("on"),e.removeAttribute("disabled"),$(".getnum").text("获取验证码"),wait=120):(e.setAttribute("disabled",!0),$(".getnum").text("重新发送("+wait+")"),wait--,setTimeout(function(){time(e)},1e3))}function antifake(e){$.ajax({async:!0,type:"get",url:path+"/getproinfo",dataType:"jsonp",jsonp:"jsoncallback",data:{fenBarCode:e},success:function(e){void 0!=e[0]&&void 0==e[0].fstkOutLogNo&&(status=0),0==e.length?status=0:void 0==e[0].fstkOutLogNo?status=0:status=1},error:function(e){alert("防伪验证失败！")}})}$(function(){var e,t,a,n,o,s,i,c,r=location.href,u=getQueryString("code");u=u.split("#"),u=u[0],r.indexOf("&state")>=0&&(r=r.split("&state="),r=r[0]+"#"+r[1],location.href=r),params=r.split("#"),params=params[1],params=r.split("~"),a=params[0],a=a.split("#"),a=a[1],state=params[1],-1==location.href.indexOf("&state")&&$.ajax({type:"get",url:path+"/getweiopenid",dataType:"jsonp",jsonp:"jsoncallback",data:{code:u},success:function(e){$(".loaderBox").hide(),t=e.openid,userinfo(t,a)},error:function(e){}}),$(".hideFocu").click(function(){$(".focus").hide()}),$(".indexBody").css("height",height+"px"),$(".form").css("height",height+"px"),$(".focus").css("height",height+"px"),$(".getnum").click(function(){return $(".getnum").addClass("on"),i=$(".phone").val(),""!=i&&11==i.length?(getNum(i),time(this)):alert("手机输入有误!"),!1}),$(".submit").click(function(){$(".loaderBox").show(),c=$(".name").val(),n="2017";var e=$(".verify").val();return""!=c?checkNum(e,a,n,o,s,t,c,void 0,i):alert("请输入姓名！"),!1}),$(".rules").click(function(){$(".ruleBox").toggle()}),$.ajax({type:"post",url:path+"/getweichatcfg",dataType:"jsonp",jsonp:"jsoncallback",data:{url:r},success:function(t){var n=t.timestamp,i=t.nonceStr;e=t.accesstoken,wx.config({debug:!1,appId:appid,timestamp:n,nonceStr:i,signature:t.signature,jsApiList:["chooseImage","checkJsApi","getLocation","scanQRCode","onMenuShareTimeline","onMenuShareAppMessage","openLocation"]}),wx.ready(function(){1==state&&(antifake(a),$(".form").show()),$(".scan").click(function(){wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){a=e.resultStr,-1!=a.indexOf("barCode=")&&(a=a.split("barCode="),a=a[1]),-1==a.indexOf("http")&&a.length>=30?(antifake(a),$(".form").show()):alert("该二维码不是防伪码!")}})}),wx.getLocation({type:"wgs84",success:function(e){s=e.latitude,o=e.longitude}})})},error:function(e){}})});var wait=120;